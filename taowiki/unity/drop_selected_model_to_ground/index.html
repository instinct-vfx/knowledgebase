<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../../img/favicon.ico">
        <title>Drop Selected Model To Ground(or closest model below) (No Colliders Needed) - My Docs</title>
        <link href="../../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/obsidian.min.css">
        <link href="../../../css/extra.css" rel="stylesheet">

        <script src="../../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../../..">My Docs</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../../.." class="nav-link">Welcome to MkDocs</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">3dsmax <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../3dsmax/3dsmax_portable/" class="dropdown-item">Making 3ds Max portable</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Taowiki <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../blender/" class="dropdown-item">Blender</a>
</li>
                                    
<li>
    <a href="../../coding/" class="dropdown-item">Coding</a>
</li>
                                    
<li>
    <a href="../../contribute/" class="dropdown-item">Contribute to the Wiki</a>
</li>
                                    
<li>
    <a href="../../gdc/" class="dropdown-item">GDC Sessions</a>
</li>
                                    
<li>
    <a href="../../houdini/" class="dropdown-item">Houdini</a>
</li>
                                    
<li>
    <a href="../../math/" class="dropdown-item">Math</a>
</li>
                                    
<li>
    <a href="../../max/" class="dropdown-item">3ds Max</a>
</li>
                                    
<li>
    <a href="../../maya/" class="dropdown-item">Maya</a>
</li>
                                    
<li>
    <a href="../../pipelines/" class="dropdown-item">Pipelines</a>
</li>
                                    
<li>
    <a href="../../python3/" class="dropdown-item">Python3</a>
</li>
                                    
<li>
    <a href="../../rigging/" class="dropdown-item">Rigging</a>
</li>
                                    
<li>
    <a href="../../shaders/" class="dropdown-item">Shaders</a>
</li>
                                    
<li>
    <a href="../../ta-101/" class="dropdown-item">Tech Art 101</a>
</li>
                                    
<li>
    <a href="../../tips/" class="dropdown-item">Tips</a>
</li>
                                    
<li>
    <a href="../../tools/" class="dropdown-item">Tools</a>
</li>
                                    
<li>
    <a href="../" class="dropdown-item">Unity</a>
</li>
                                    
<li>
    <a href="../../unreal/" class="dropdown-item">Unreal</a>
</li>
                                    
<li>
    <a href="../../vfx/" class="dropdown-item">VFX</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Contribute</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../contribute/how_to_add_page/" class="dropdown-item">How to add a page to the Wiki</a>
</li>
            
<li>
    <a href="../../contribute/how_to_edit_page/" class="dropdown-item">How to edit a wiki page</a>
</li>
            
<li>
    <a href="../../contribute/how_to_setup_dev_env/" class="dropdown-item">How to setup a development environment</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Houdini</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../houdini/houdini_hda_naming_conventions_without_sql_database/" class="dropdown-item">Houdini HDA Naming Conventions without a SQL database</a>
</li>
            
<li>
    <a href="../../houdini/houdini_setting_up_a_studio_environment/" class="dropdown-item">Houdini Setting up a studio environment</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Max</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../max/pymxs_helpful_snippets/" class="dropdown-item">pymxs Helpful Snippets</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Python3</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../python3/python3-snippets/" class="dropdown-item">Python3 Snippets</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Python3 snippets</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../python3/python3-snippets/extract_icon_from_exe/" class="dropdown-item">Py3 Extract icon from exe and save as png (with alpha)</a>
</li>
            
<li>
    <a href="../../python3/python3-snippets/latest_installed_program/" class="dropdown-item">Find Latest Installed Program on System</a>
</li>
            
<li>
    <a href="../../python3/python3-snippets/threaded_animation/" class="dropdown-item">Console: Threaded "WIP" animation</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Ta 101</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../ta-101/job-descriptions/" class="dropdown-item">Tech Art Job Descriptions</a>
</li>
            
<li>
    <a href="../../ta-101/ta-coding-101/" class="dropdown-item">Tech Art Coding 101</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Job descriptions</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../ta-101/job-descriptions/job-descriptions-film/" class="dropdown-item">Tech Art Job Descriptions in Film</a>
</li>
            
<li>
    <a href="../../ta-101/job-descriptions/job-descriptions-games/" class="dropdown-item">Tech Art Job Descriptions in Games</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Game ta disciplines</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../ta-101/job-descriptions/game-ta-disciplines/animation-n-rigging/" class="dropdown-item">Animation/Rigging Tech Art Job Description in Games</a>
</li>
            
<li>
    <a href="../../ta-101/job-descriptions/game-ta-disciplines/pipeline/" class="dropdown-item">Pipeline Tech Art Job Description in Games</a>
</li>
            
<li>
    <a href="../../ta-101/job-descriptions/game-ta-disciplines/shaders/" class="dropdown-item">Shaders Tech Art Job Description in Games</a>
</li>
            
<li>
    <a href="../../ta-101/job-descriptions/game-ta-disciplines/visual-effects/" class="dropdown-item">Visual Effects Tech Art Job Description in Games</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Unity</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="./" class="dropdown-item active">Drop Selected Model To Ground(or closest model below) (No Colliders Needed)</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Unreal</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../unreal/how_to_make_an_actor_that_can_tick_in_editor/" class="dropdown-item">[Unreal] How to make an actor that can Tick In Editor</a>
</li>
            
<li>
    <a href="../../unreal/tickable_pyside2_window_baseclass/" class="dropdown-item">Tickable PySide2 Window BaseClass</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../../ta-101/job-descriptions/game-ta-disciplines/visual-effects/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../../unreal/how_to_make_an_actor_that_can_tick_in_editor/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<p>Editor Script/Menu Item - Put in script in Editor Folder.
Allows for a single selected object to be dropped to the next nearest model below it. 
Model that is dropped to ground is dropped to the pivot (something to note if your pivots are center of model etc)</p>
<pre><code class="language-C#">using System.Collections.Generic;
using System.Linq;
using Luna;
using UnityEditor;
using UnityEngine;

public class EditorMenuItems : MonoBehaviour
{
        [MenuItem(&quot;GameObject/Set Object On Ground - No Collider #G&quot;, false, 10)]
        private static void SetObjectOnGround()
        {
            GameObject selection  = Selection.activeGameObject;
            Transform[] allObjects = UnityEngine.Object.FindObjectsOfType&lt;Transform&gt;() ;
            //Try to find the objects that are closest to the current GO
            IEnumerable&lt;Transform&gt; closeObjects = allObjects.Where(o =&gt;  o.position.y &lt; selection.transform.position.y 
                                                     &amp;&amp; o.gameObject != selection.gameObject
                                                     &amp;&amp; o.GetComponent&lt;MeshRenderer&gt;() 
                                                     &amp;&amp; PointContainedIn2DPlane(selection.transform.position, o.GetComponent&lt;MeshRenderer&gt;().bounds));

            Vector3 hitPoint = Vector3.zero;
            float closestDist = 10000;
            foreach (Transform closeObject in closeObjects)
            {
                RaycastHit hit = new RaycastHit();
                bool bHit = HandleUtilityWrapper.IntersectRayMesh(new Ray(selection.transform.position, Vector3.down), closeObject.GetComponent&lt;MeshFilter&gt;(), out hit);
                if (!bHit)
                {
                    continue;
                }
                if (hit.distance &lt; closestDist)
                {
                    // Debug.Log($&quot;Updating Closest: {closeObject.name} dist:{hit.distance}&quot;);
                    hitPoint = hit.point;
                    closestDist = hit.distance;
                }
            }

            Vector3 position = selection.transform.position;
            position = new Vector3(position.x, hitPoint.y, position.z);
            selection.transform.position = position;
        }

        private static bool PointContainedIn2DPlane(Vector3 point, Bounds bounds)
        {
            if ((point.x &gt; bounds.min.x &amp;&amp; point.x &lt; bounds.max.x) &amp;&amp; (point.z &gt; bounds.min.z &amp;&amp; point.z &lt; bounds.max.z))
            {
                return true;
            }

            return false;
        }
}
</code></pre>
<p>Class that opens access to mesh ray casting (Code adapted from <a href="https://gist.github.com/MattRix/9205bc62d558fef98045">Gist</a>)</p>
<pre><code class="language-C#">using System;
using System.Reflection;
using UnityEngine;
using UnityEditor;
using System.Linq;
​
// Allows for access to Unity function that they haven't made public (through reflection)
// Makes it so we can do mesh raycasting (no colliders)
[InitializeOnLoad]
    public static class HandleUtilityWrapper
    {
        private static readonly Type       HandleUtility;
        private static readonly MethodInfo IntersectRayMeshMethodInfo;
​
        static HandleUtilityWrapper()
        {
            var editorTypes = typeof(Editor).Assembly.GetTypes();
            HandleUtility              = editorTypes.FirstOrDefault(t =&gt; t.Name == &quot;HandleUtility&quot;);
            IntersectRayMeshMethodInfo = HandleUtility.GetMethod(&quot;IntersectRayMesh&quot;, BindingFlags.Static | BindingFlags.NonPublic);
        }
​
        public static bool IntersectRayMesh(Ray ray, MeshFilter meshFilter, out RaycastHit hit)
        {
            return IntersectRayMesh(ray, meshFilter.sharedMesh, meshFilter.transform.localToWorldMatrix, out hit);
        }
​
        private static object[] _parms = new object[4];
​
        public static bool IntersectRayMesh(Ray ray, Mesh mesh, Matrix4x4 matrix, out RaycastHit hit)
        {
            _parms[0] = ray;
            _parms[1] = mesh;
            _parms[2] = matrix;
            _parms[3] = null;
​
            var result = (bool) IntersectRayMeshMethodInfo.Invoke(null, _parms);
            hit = (RaycastHit) _parms[3];
            return result;
        }
    }
​
</code></pre>
<p><a href="https://github.com/techartorg/TAO-Wiki/wiki/Drop-Selected-Model-To-Ground(or-closest-model-below)-(No-Colliders-Needed)">original source</a></p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../../js/base.js" defer></script>
        <script src="../../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
